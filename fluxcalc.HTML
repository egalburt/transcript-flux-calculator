<html>
    
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
</head>
    
<body>

<h1><center>TRANSCRIPT FLUX CALCULATOR 1: Flux Ratio</center></h1>

<div class="column">

<div class="row" align="justify">
    
    This calculator explores the effects of different combinations of basal (unregulated) and regulated rates on transcript
    flux. The initiation mechanism consists of three states: free promoter (R+P), closed complex (RP<sub><small>c</small></sub>), and open complex (RP<sub><small>o</small></sub>) with reversible transitions between R+P, RP<sub><small>c</small></sub> , and RP<sub><small>o</small></sub>. From open complex, the polymerase may irreversibly escape the promoter resulting in a free promoter and an mRNA transcript. The concentration of the polymerase ([R]) is also modeled explicitly. First, enter basal rate constants for the promoter of interest in the boxes below. The flux control coefficients determined by the set of basal rate constants will be displayed (C<sup><small>&phi;</small></sup>). Second, move the slider bars to set how that particular parameter will be regulated. The output will be displayed on the right in real time. Both the basal and regulated mRNA flux and the flux ratio are reported numerically. In addition, the area of the circle represents the flux ratio graphically with larger green circles indicating activation and smaller red circles indicating repression. Lastly, the relative free energy landscapes depicting the state and transition states are plotted for comparison in units of ln(1/s). <em>See Reference for more information.</em>
    
</div>
<p></p>
<div class="row">

  <div class="minicolumnleft">
    <font size=5>
    <b>k<span class='supsub'>
      <sup class='superscript'>basal</sup>
      <sub class='subscript'>on</sub></b></span>
        <input type="number" min="0.01" step="0.01" id="onrate" value="0.1">
        &nbsp;&nbsp;&nbsp;C<span class='supsub'>
      <sup class='superscript'>&phi;</sup>
        <sub class='subscript'>on</sub></b></span> <span class="greyboxlight" id="CCkon"></span>

    </div>

  <div align="right" class="minicolumnright">
    <b>k<span class='supsub'>
      <sup class='superscript' align="left">reg</sup>
      <sub class='subscript' align="left">on</sub></b></span>
    <span class="greyboxdark" id="onnew"></span>
  </div>

  <div id="slidecontainer">
    <input type="range" min="0.1" max="50" value="1" step="0.1" class="slider" id="onratio">
  </div>
</div>

<p></p>

<div class="row">

  <div class="minicolumnleft">
    <b>k<span class='supsub'>
      <sup class='superscript'>basal</sup>
      <sub class='subscript'>off</sub></b></span>
    <input type="number" min="0.01" step="0.01" id="offrate" value="10">
      &nbsp;&nbsp;&nbsp;C<span class='supsub'>
      <sup class='superscript'>&phi;</sup>
      <sub class='subscript'>off</sub></b></span> <span class="greyboxlight" id="CCkoff"></span>
  </div>

  <div align="right" class="minicolumnright">
    <b>k<span class='supsub'>
      <sup class='superscript' align="left">reg</sup>
      <sub class='subscript' align="left">off</sub></b></span>
    <span class="greyboxdark" id="offnew"></span>
  </div>

  <div id="slidecontainer">
    <input type="range" min="0.1" max="50" value="1" step="0.1" class="slider" id="offratio">
  </div>
</div>

<p></p>

<div class="row">

  <div class="minicolumnleft">
    <b>k<span class='supsub'>
      <sup class='superscript'>basal</sup>
      <sub class='subscript'>open</sub></b></span>
    <input type="number" min="0.000001" step="0.000001" id="openrate" value="1">
      &nbsp;&nbsp;&nbsp;C<span class='supsub'>
      <sup class='superscript'>&phi;</sup>
      <sub class='subscript'>open</sub></b></span> <span class="greyboxlight" id="CCkopen"></span>

  </div>

  <div align="right" class="minicolumnright">
    <b>k<span class='supsub'>
      <sup class='superscript' align="left">reg</sup>
      <sub class='subscript' align="left">open</sub></b></span>
    <span class="greyboxdark" id="opennew"></span>
  </div>

  <div id="slidecontainer">
    <input type="range" min="0.1" max="25" value="1" step="0.1" class="slider" id="openratio">
  </div>
</div>

<p></p>

<div class="row">
  <div class="minicolumnleft">
    <b>k<span class='supsub'>
      <sup class='superscript'>basal</sup>
      <sub class='subscript'>close</sub></b></span>
    <input type="number" min="0.000001" step="0.000001" id="closerate" value="10">
      &nbsp;&nbsp;&nbsp;C<span class='supsub'>
      <sup class='superscript'>&phi;</sup>
      <sub class='subscript'>close</sub></b></span> <span class="greyboxlight" id="CCkclose"></span>

  </div>

  <div align="right" class="minicolumnright">
    <b>k<span class='supsub'>
      <sup class='superscript' align="left">reg</sup>
      <sub class='subscript' align="left">close</sub></b></span>
    <span class="greyboxdark" id="closenew"></span>
  </div>

  <div id="slidecontainer">
    <input type="range" min="0.1" max="50" value="1" step="0.1" class="slider" id="closeratio">
  </div>
</div>

<p></p>

<div class="row">
  <div class="minicolumnleft">
    <b>k<span class='supsub'>
    <sup class='superscript'>basal</sup>
    <sub class='subscript'>escape</sub></b></span>
    <input type="number" min="0.000001" step="0.000001" id="escaperate" value="10">
      &nbsp;&nbsp;&nbsp;C<span class='supsub'>
      <sup class='superscript'>&phi;</sup>
      <sub class='subscript'>escape</sub></b></span> <span class="greyboxlight" id="CCkescape"></span>

  </div>

  <div align="right" class="minicolumnright">
    <b>k<span class='supsub'>
      <sup class='superscript' align="left">reg</sup>
      <sub class='subscript' align="left">escape</sub></b></span>
    <span class="greyboxdark" id="escapenew"></span>
  </div>

  <div id="slidecontainer">
    <input type="range" min="0.1" max="50" value="1" step="0.1" class="slider" id="escaperatio">
  </div>
</div>

<p></p>

<div class="row">
  <div class="minicolumnleft">
    <b>[R]<span class='supsub'>
      <sup class='superscript'>basal</sup>
      <sub class='subscript'><font color=#fff>0</font></sub></b></span>
    <input type="number" min="0.01" step="0.01" id="concentration" value="1000">
      &nbsp;&nbsp;&nbsp;C<span class='supsub'>
      <sup class='superscript'>&phi;</sup>
      <sub class='subscript'>[R]</sub></b></span> <span class="greyboxlight" id="CCR"></span>

  </div>

  <div align="right" class="minicolumnright">
    <b>[R]<span class='supsub'>
      <sup class='superscript' align="left">reg</sup>
      <sub class='subscript' align="left"><font color=#fff>0</font></sub></b></span>
    <span class="greyboxdark" id="concnew"></span>
  </div>

  <div id="slidecontainer">
    <input type="range" min="0.1" max="50" value="1" step="0.1" class="slider" id="concratio">
  </div>
</div>
</div>

<div class="column">
<canvas id="myCanvas" width="500px" height="200px" style="border:0px solid #000000;"></canvas>
<canvas id="myChart" style="border:2px solid #000000;"></canvas>
</div>
      
    
</body>
</html>





<style type="text/css">

* {
    box-sizing: border-box;
}
    
html, body {
  width:  100%;
  height: 100%;
  margin: 0px;
}
    
/* Create two equal columns that floats next to each other */
.column {
    float: left;
    width: 50%;
    padding: 10px;
}

/* Clear floats after the columns */
.row:after {
    content: "";
    display: table;
    clear: both;
}

.minicolumnleft {
    float: left;
    width: 50%;
}

.minicolumnright {
    float: right;
    width: 50%;
}

/* Clear floats after the columns */
.row:after {
    content: "";
    display: table;
    clear: both;
}
#slidecontainer {
    width: 100%; /* Width of the outside container */
}

/* The slider itself */
.slider {
    -webkit-appearance: none;  /* Override default CSS styles */
    appearance: none;
    width: 100%; /* Full-width */
    height: 25px; /* Specified height */
    background: #d3d3d3; /* Grey background */
    outline: none; /* Remove outline */
    opacity: 0.7; /* Set transparency (for mouse-over effects on hover) */
    -webkit-transition: .2s; /* 0.2 seconds transition on hover */
    transition: opacity .2s;
}

/* Mouse-over effects */
.slider:hover {
    opacity: 1; /* Fully shown on mouse-over */
}

/* The slider handle (use webkit (Chrome, Opera, Safari, Edge) and moz (Firefox) to override default look) */
.slider::-webkit-slider-thumb {
    -webkit-appearance: none; /* Override default look */
    appearance: none;
    width: 25px; /* Set a specific slider handle width */
    height: 25px; /* Slider handle height */
    background: #4CAF50; /* Green background */
    cursor: pointer; /* Cursor on hover */
}

.slider::-moz-range-thumb {
    width: 25px; /* Set a specific slider handle width */
    height: 25px; /* Slider handle height */
    background: #4CAF50; /* Green background */
    cursor: pointer; /* Cursor on hover */
}

input {
    font-size: 24px;
    width: 3em ;
    box-sizing: border-box;
    border: 1px solid black;
    border-radius: 2px;
}

span.greyboxdark {
    color: #000000;
    background: #999;
    margin: 0 0 0 0;
    border-width: 1px 1px 1px 1px;
    border-style: solid;
    border-radius: 2px;
    border-color: #000;
    padding: 5px 5px 1px 5px;
}
    
span.greyboxlight {
    color: #000000;
    background: #ccc;
    margin: 0 0 0 0;
    border-width: 1px 1px 1px 1px;
    border-style: solid;
    border-radius: 2px;
    border-color: #000;
    padding: 5px 5px 1px 5px;
}

.supsub {
    display: inline-block;
}

.supsub sup,
.supsub sub {
    position: relative;
    display: block;
    font-size: .5em;
    line-height: 1.1;
}

.supsub sub {
    top: .2em;
}

</style>




<script>

  var conc = document.getElementById("concentration").value;
  var kon = document.getElementById("onrate").value;
  var koff = document.getElementById("offrate").value;
  var kopen = document.getElementById("openrate").value;
  var kclose = document.getElementById("closerate").value;
  var kescape = document.getElementById("escaperate").value;

  var concslider = document.getElementById("concratio");
  var concoutput = document.getElementById("concnew");

  var onslider = document.getElementById("onratio");
  var onoutput = document.getElementById("onnew");

  var offslider = document.getElementById("offratio");
  var offoutput = document.getElementById("offnew");

  var openslider = document.getElementById("openratio");
  var openoutput = document.getElementById("opennew");

  var closeslider = document.getElementById("closeratio");
  var closeoutput = document.getElementById("closenew");

  var escapeslider = document.getElementById("escaperatio");
  var escapeoutput = document.getElementById("escapenew");

  var bFLUX = flux(conc, kon, koff, kopen, kclose, kescape);
  var rFLUX = flux(conc*concslider.value, kon*onslider.value, koff*offslider.value, kopen*openslider.value, kclose*closeslider.value, kescape*escapeslider.value);

  var A = 1000;
    
  var bDATA = [2,0,-Math.log(kon*conc/A),-Math.log(kon*conc/A)+Math.log(koff/A),-Math.log(kon*conc/A)+Math.log(koff/A)-Math.log(kopen/A),-Math.log(kon*conc/A)+Math.log(koff/A)-Math.log(kopen/A)+Math.log(kclose/A),-Math.log(kon*conc/A)+Math.log(koff/A)-Math.log(kopen/A)+Math.log(kclose/A)-Math.log(kescape/A),-Math.log(kon*conc/A)+Math.log(koff/A)-Math.log(kopen/A)+Math.log(kclose/A)-Math.log(kescape/A)-5];
    
  var rDATA = [2,0,-Math.log(kon*conc/A),-Math.log(kon*conc/A)+Math.log(koff/A),-Math.log(kon*conc/A)+Math.log(koff/A)-Math.log(kopen/A),-Math.log(kon*conc/A)+Math.log(koff/A)-Math.log(kopen/A)+Math.log(kclose/A),-Math.log(kon*conc/A)+Math.log(koff/A)-Math.log(kopen/A)+Math.log(kclose/A)-Math.log(kescape/A),-Math.log(kon*conc/A)+Math.log(koff/A)-Math.log(kopen/A)+Math.log(kclose/A)-Math.log(kescape/A)-5];
    
  var k1 = parseFloat(kon);
  var k2 = parseFloat(koff);
  var k3 = parseFloat(kopen);
  var k4 = parseFloat(kclose);
  var k5 = parseFloat(kescape);
  var R =  parseFloat(conc);
    
  var k45 = k4+k5;
  var Kcombo = (k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5));
    
  //control coefficients  
        
  CCkon.innerHTML = (((k4 + k5)*((R*k3*k5)/((k4 + k5)*(k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5))) - (R*k1*k3*k5*(R + (R*k3)/(k4 + k5)))/((k4 + k5)*Math.pow((k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5)),2))) * (k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5)))/(R*k3*k5)).toFixed(2);
  //CCkon2.innerHTML = ( 1 - (k1*R*(1+k3/k45)) / Kcombo ).toFixed(2);
        
  CCkoff.innerHTML = (-k2/(k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5))).toFixed(2);
  //CCkoff2.innerHTML = (-k2/Kcombo).toFixed(2);
    
  CCkopen.innerHTML = ((((R*k1*k5)/((k4 + k5)*(k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5))) + (R*k1*k3*k5*((k4 - R*k1)/(k4 + k5) - 1))/((k4 + k5)*Math.pow((k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5)),2)))*(k4 + k5)*(k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5)))/(R*k1*k5)).toFixed(2);
  //CCkopen2.innerHTML = (1-(k3*(k1*R+k5)/(k45*Kcombo))).toFixed(2);

  CCkclose.innerHTML = (-(k4*(k4 + k5)*((R*k1*k3*k5)/(Math.pow((k4 + k5),2)*(k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5))) - (R*k1*k3*k5*(k3/(k4 + k5) - (k3*(k4 - R*k1))/Math.pow((k4 + k5),2)))/((k4 + k5)*  Math.pow( (k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5)),2)  ))*(k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5))) / (R*k1*k3*k5) ).toFixed(2);
  //CCkclose2.innerHTML = (-k4*(1/k45 - (k3/(k45*Kcombo) - (k3*(k4 - R*k1))/(Math.pow(k45,2)*Kcombo)))).toFixed(2);

  CCkescape.innerHTML = (-((k4 + k5)*((R*k1*k3*k5)/(Math.pow((k4 + k5),2)*(k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5))) - (R*k1*k3)/((k4 + k5)*(k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5))) + (R*k1*Math.pow(k3,2)*k5*(k4 - R*k1))/(Math.pow((k4 + k5),3)*Math.pow((k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5)),2)))*(k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5)))/(R*k1*k3)).toFixed(2);      
  //CCkescape2.innerHTML = (1 - (k5/k45) - (k3*k5*(k4 - R*k1))/(Math.pow(k45,2)*Kcombo)).toFixed(2);
    
  CCR.innerHTML = (((k4 + k5)*((k1*k3*k5)/((k4 + k5)*(k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5))) - (R*k1*k3*k5*(k1 + (k1*k3)/(k4 + k5)))/((k4 + k5)*Math.pow((k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5)),2)))*(k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5)))/(k1*k3*k5)).toFixed(2);
  //CCR2.innerHTML = (1-(R*k1*(k45+k3))/(k45*Kcombo)).toFixed(2);

    
var canvas; 
var context;
var centerX;
var center;
var ratext; 
var btext; 
var retext;

    (function() {
			var 
				// Obtain a reference to the canvas element
				// using its id.
				canvas = document.getElementById('myCanvas'),
			
			  	// Obtain a graphics context on the
			  	// canvas element for drawing.
			  	context = canvas.getContext('2d');
 
			// Start listening to resize events and
			// draw canvas.
			initialize();
 
			function initialize() {
				// Register an event listener to
				// call the resizeCanvas() function each time 
				// the window is resized.
				window.addEventListener('resize', resizeCanvas, false);
				
				// Draw canvas border for the first time.
				resizeCanvas();
			}
				
			// Display custom canvas.
			// In this case it's a blue, 5 pixel border that 
			// resizes along with the browser window.					
			function redraw(r,g,b,a,rad,ratiotext,basaltext,regtext) {
                context.clearRect(0, 0, canvas.width, canvas.height);

                centerX = 15*canvas.width / 24;
                centerY = canvas.height / 2;
                ratext = 'Ratio = '+ ratiotext.toFixed(2);
                btext = 'Basal = '+ Number(basaltext).toFixed(2) +' 1/min';
                retext = 'Regulated = '+ Number(regtext).toFixed(2) +' 1/min';
                
                context.beginPath();
                context.arc(centerX, centerY, Math.sqrt(rad)*Math.sqrt(50), 0, 2 * Math.PI, false);
                context.fillStyle = 'rgba('+Number(r)+','+Number(g)+','+Number(b)+','+Number(a)+')';
                context.lineWidth = 1;
                context.strokeStyle = '#003300';
                context.stroke();
                context.closePath();
                context.fill();
                
                context.beginPath();
                context.arc(centerX, centerY, 50, 0, 2 * Math.PI, false);
                context.fillStyle ='rgba(0,0,0,0)';
                context.lineWidth = 5;
                context.strokeStyle = '#003300';
                context.stroke();
                context.closePath();
                context.fill();
                
                context.font = '30px Arial';
                context.fillStyle = "black";
                context.fillText(ratext, 5, canvas.height-10);
                context.font = '20px Arial';
                context.fillText(btext, 5, 20);
                context.fillText(retext, 5, 40);
			}
		
			// Runs each time the DOM window resize event fires.
			// Resets the canvas dimensions to match window,
			// then draws the new borders accordingly.
			function resizeCanvas() {
				canvas.width = window.innerWidth/2.5;
				canvas.height = window.innerHeight/2.5;
                if (rFLUX/bFLUX == 1) {
                redraw(0,0,0,0,50,1,bFLUX,rFLUX);
              } else if (rFLUX/bFLUX > 1) {
                redraw(0,255,0,(Number(rFLUX)-Number(bFLUX))/(Number(rFLUX)+Number(bFLUX)),rFLUX/bFLUX*50,rFLUX/bFLUX,bFLUX,rFLUX);
              } else {
                redraw(255,0,0,(Number(bFLUX)-Number(rFLUX))/(Number(rFLUX)+Number(bFLUX)),rFLUX/bFLUX*50,rFLUX/bFLUX,bFLUX,rFLUX);
              }
			}
		
		})();
    
  function draw(r,g,b,a,rad,ratiotext,basaltext,regtext) {
    canvas = document.getElementById('myCanvas');
    context = canvas.getContext('2d');
    centerX = 15 * canvas.width / 24;
    centerY = canvas.height/2;
    ratext = 'Ratio = '+ ratiotext.toFixed(2);
    btext = 'Basal = '+ Number(basaltext).toFixed(2) +' 1/min';
    retext = 'Regulated = '+ Number(regtext).toFixed(2) +' 1/min';

    context.clearRect(0, 0, canvas.width, canvas.height);

    context.beginPath();
    context.arc(centerX, centerY, Math.sqrt(rad)*Math.sqrt(50), 0, 2 * Math.PI, false);
    context.fillStyle = 'rgba('+Number(r)+','+Number(g)+','+Number(b)+','+Number(a)+')';
    context.lineWidth = 1;
    context.strokeStyle = '#003300';
    context.stroke();
    context.closePath();
    context.fill();

    context.beginPath();
    context.arc(centerX, centerY, 50, 0, 2 * Math.PI, false);
    context.fillStyle = 'rgba(0,0,0,0)';
    context.lineWidth = 5;
    context.strokeStyle = '#003300';
    context.stroke();
    context.closePath();
    context.fill();

    context.font = '30px Arial';
    context.fillStyle = "black";
    context.fillText(ratext, 5, canvas.height-10);
    context.font = '20px Arial';
    context.fillText(btext, 5, 20);
    context.fillText(retext, 5, 40);
  }

  Chart.defaults.global.legend.display = false;
  Chart.defaults.global.xAxes = false;

  function plot(data1,data2,rColor) {

    var ctx = document.getElementById("myChart");
    var myChart = new Chart(ctx, {
    type: 'line',

    data: {
    labels: ['','R+P','','RPc','','RPo','','R+P+mRNA'],
    datasets: [
      {
        data: data1, fill:false, borderColor:'#000000'
      },
      {
        data: data2, fill:false, borderColor:rColor
      }
    ]},

    options: {
       
      events:[],
      animation: {
        duration: 0
      },
      
      scales: {
        xAxes: [{
                ticks: {
                    fontSize: 12,
                    fontStyle: "bold",
                    fontColor:"#000000",
                    maxRotation: 0
                },
                gridLines: {
                    display:true
                },
                scaleLabel: {
                    display:true,
                    labelString: "Reaction Coordinate",
                    fontSize: 14,
                    fontColor:"#000000"
                }
            }],
        yAxes: [{
                ticks: {
                    fontSize: 12,
                    fontStyle: "bold",
                    fontColor:"#000000",
                    suggestedMin: -5,
                    suggestedMax: 10
                },
                gridLines: {
                    drawBorder:false,
                    display:false
                },
            scaleLabel: {
                    display:true,
                    labelString: "Free Energy (ln(1/s))",
                    fontSize: 14,
                    fontColor:"#000000"
                }
            }]
       }
     }
});


  }

  function flux(nM, on, off, open, close, escape) {
    var tpm = 60 * escape * Number(on*nM) / (Number(on*nM) + Number(open) + Number(off) - Number(open * (Number(close)-Number(on*nM)) / (Number(close)+Number(escape)) ) ) * (open/(Number(close)+Number(escape)));
    return tpm.toFixed(3);
  }

  function basalFunction() {
      kon = document.getElementById("onrate").value;
      koff = document.getElementById("offrate").value;
      kopen = document.getElementById("openrate").value;
      kclose = document.getElementById("closerate").value;
      kescape = document.getElementById("escaperate").value;
      conc = document.getElementById("concentration").value;

      onnew.innerHTML = Math.round(kon*onslider.value*100)/100;
      offnew.innerHTML = Math.round(koff*offslider.value*100)/100;
      opennew.innerHTML = Math.round(kopen*openslider.value*100)/100;
      closenew.innerHTML = Math.round(kclose*closeslider.value*100)/100;
      escapenew.innerHTML = Math.round(kescape*escapeslider.value*100)/100;
      concnew.innerHTML = Math.round(conc*concslider.value*100)/100;

      bFLUX = flux(conc, kon, koff, kopen, kclose, kescape);
      rFLUX = flux(conc*concslider.value, kon*onslider.value, koff*offslider.value, kopen*openslider.value, kclose*closeslider.value, kescape*escapeslider.value);
      
      var k1 = parseFloat(kon);
      var k2 = parseFloat(koff);
      var k3 = parseFloat(kopen);
      var k4 = parseFloat(kclose);
      var k5 = parseFloat(kescape);
      var R =  parseFloat(conc);
      
      var k45 = k4+k5;
      var Kcombo = (k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5));

      //control coefficients    
      CCkon.innerHTML = (((k4 + k5)*((R*k3*k5)/((k4 + k5)*(k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5))) - (R*k1*k3*k5*(R + (R*k3)/(k4 + k5)))/((k4 + k5)*Math.pow((k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5)),2))) * (k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5)))/(R*k3*k5)).toFixed(2);
      //CCkon2.innerHTML = ( 1 - (k1*R*(1+k3/k45)) / Kcombo ).toFixed(2);

      CCkoff.innerHTML = (-k2/(k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5))).toFixed(2);
      //CCkoff2.innerHTML = (-k2/Kcombo).toFixed(2);

      CCkopen.innerHTML = ((((R*k1*k5)/((k4 + k5)*(k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5))) + (R*k1*k3*k5*((k4 - R*k1)/(k4 + k5) - 1))/((k4 + k5)*Math.pow((k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5)),2)))*(k4 + k5)*(k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5)))/(R*k1*k5)).toFixed(2);
      //CCkopen2.innerHTML = (1-(k3*(k1*R+k5)/(k45*Kcombo))).toFixed(2);

      CCkclose.innerHTML = (-(k4*(k4 + k5)*((R*k1*k3*k5)/(Math.pow((k4 + k5),2)*(k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5))) - (R*k1*k3*k5*(k3/(k4 + k5) - (k3*(k4 - R*k1))/Math.pow((k4 + k5),2)))/((k4 + k5)*  Math.pow( (k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5)),2)  ))*(k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5))) / (R*k1*k3*k5)  ).toFixed(2);
      //CCkclose2.innerHTML = (-k4*(1/k45 - (k3/(k45*Kcombo) - (k3*(k4 - R*k1))/(Math.pow((k4 + k5),2)*Kcombo)))).toFixed(2);

      CCkescape.innerHTML = (-((k4 + k5)*((R*k1*k3*k5)/(Math.pow((k4 + k5),2)*(k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5))) - (R*k1*k3)/((k4 + k5)*(k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5))) + (R*k1*Math.pow(k3,2)*k5*(k4 - R*k1))/(Math.pow((k4 + k5),3)*Math.pow((k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5)),2)))*(k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5)))/(R*k1*k3)).toFixed(2);
      //CCkescape2.innerHTML = (1 - (k5/k45) - (k3*k5*(k4 - R*k1))/(Math.pow(k45,2)*Kcombo)).toFixed(2);
      
      CCR.innerHTML = (((k4 + k5)*((k1*k3*k5)/((k4 + k5)*(k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5))) - (R*k1*k3*k5*(k1 + (k1*k3)/(k4 + k5)))/((k4 + k5)*Math.pow((k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5)),2)))*(k2 + k3 + R*k1 - (k3*(k4 - R*k1))/(k4 + k5)))/(k1*k3*k5)).toFixed(2);
      //CCR2.innerHTML = (1-(R*k1*(k45+k3))/(k45*Kcombo)).toFixed(2);

      //document.getElementById("basal").innerHTML = "The basal transcript flux at equilibrium is " + bFLUX + " per minute";
      //document.getElementById("regulated").innerHTML = "The regulated transcript flux at equilibrium is " + rFLUX + " per minute";
      //document.getElementById("ratio").innerHTML = "The flux ratio is " + rFLUX/bFLUX;

      if (rFLUX/bFLUX == 1) {
        draw(0,0,0,0,50,1,bFLUX,rFLUX);
      } else if (rFLUX/bFLUX > 1) {
        draw(0,255,0,(Number(rFLUX)-Number(bFLUX))/(Number(rFLUX)+Number(bFLUX)),rFLUX/bFLUX*50,rFLUX/bFLUX,bFLUX,rFLUX);
      } else {
        draw(255,0,0,(Number(bFLUX)-Number(rFLUX))/(Number(rFLUX)+Number(bFLUX)),rFLUX/bFLUX*50,rFLUX/bFLUX,bFLUX,rFLUX);
      }

      bDATA = [2,0,-Math.log(kon*conc/1000),-Math.log(kon*conc/A)+Math.log(koff/A),-Math.log(kon*conc/A)+Math.log(koff/A)-Math.log(kopen/A),-Math.log(kon*conc/A)+Math.log(koff/A)-Math.log(kopen/A)+Math.log(kclose/A),-Math.log(kon*conc/A)+Math.log(koff/A)-Math.log(kopen/A)+Math.log(kclose/A)-Math.log(kescape/A),-Math.log(kon*conc/A)+Math.log(koff/A)-Math.log(kopen/A)+Math.log(kclose/A)-Math.log(kescape/A)-5];
      
    rDATA = [2,0,-Math.log(kon*onslider.value*conc*concslider.value/1000),-Math.log(kon*onslider.value*conc*concslider.value/A)+Math.log(koff*offslider.value/A),-Math.log(kon*onslider.value*conc*concslider.value/A)+Math.log(koff*offslider.value/A)-Math.log(kopen*openslider.value/A),-Math.log(kon*onslider.value*conc*concslider.value/A)+Math.log(koff*offslider.value/A)-Math.log(kopen*openslider.value/A)+Math.log(kclose*closeslider.value/A),-Math.log(kon*onslider.value*conc*concslider.value/A)+Math.log(koff*offslider.value/A)-Math.log(kopen*openslider.value/A)+Math.log(kclose*closeslider.value/A)-Math.log(kescape*escapeslider.value/A),-Math.log(kon*onslider.value*conc*concslider.value/A)+Math.log(koff*offslider.value/A)-Math.log(kopen*openslider.value/A)+Math.log(kclose*closeslider.value/A)-Math.log(kescape*escapeslider.value/A)-5];
      
      if (rFLUX/bFLUX <= 1) {
        plot(bDATA,rDATA,'#ff0000');
      } else {
        plot(bDATA,rDATA,'#008000');
      }

  }

  function regulatedFunction() {

      rFLUX = flux(conc*concslider.value, kon*onslider.value, koff*offslider.value, kopen*openslider.value, kclose*closeslider.value, kescape*escapeslider.value);
      //document.getElementById("regulated").innerHTML = "The regulated transcript flux at equilibrium is: " + rFLUX + " per minute";
      //document.getElementById("ratio").innerHTML = "The flux ratio is " + rFLUX/bFLUX;

      if (rFLUX/bFLUX == 1) {
        draw(0,0,0,0,50,1,bFLUX,rFLUX);
      } else if (rFLUX/bFLUX > 1) {
        draw(0,255,0,(Number(rFLUX)-Number(bFLUX))/(Number(rFLUX)+Number(bFLUX)),rFLUX/bFLUX*50,rFLUX/bFLUX,bFLUX,rFLUX);
      } else {
        draw(255,0,0,(Number(bFLUX)-Number(rFLUX))/(Number(rFLUX)+Number(bFLUX)),rFLUX/bFLUX*50,rFLUX/bFLUX,bFLUX,rFLUX);
      }

      rDATA = [2,0,-Math.log(kon*onslider.value*conc*concslider.value/1000),-Math.log(kon*onslider.value*conc*concslider.value/A)+Math.log(koff*offslider.value/A),-Math.log(kon*onslider.value*conc*concslider.value/A)+Math.log(koff*offslider.value/A)-Math.log(kopen*openslider.value/A),-Math.log(kon*onslider.value*conc*concslider.value/A)+Math.log(koff*offslider.value/A)-Math.log(kopen*openslider.value/A)+Math.log(kclose*closeslider.value/A),-Math.log(kon*onslider.value*conc*concslider.value/A)+Math.log(koff*offslider.value/A)-Math.log(kopen*openslider.value/A)+Math.log(kclose*closeslider.value/A)-Math.log(kescape*escapeslider.value/A),-Math.log(kon*onslider.value*conc*concslider.value/A)+Math.log(koff*offslider.value/A)-Math.log(kopen*openslider.value/A)+Math.log(kclose*closeslider.value/A)-Math.log(kescape*escapeslider.value/A)-5];
      if (rFLUX/bFLUX <= 1) {
        plot(bDATA,rDATA,'#ff0000');
      } else {
        plot(bDATA,rDATA,'#008000');
      }

  }

  draw(0,255,0,0,50,1,bFLUX,rFLUX);
  plot(bDATA,rDATA,'#ff0000');

  //calculate regulated(new) values by multiplying by ratio
  onnew.innerHTML = Math.round(kon*onslider.value*100)/100;
  offnew.innerHTML = Math.round(koff*offslider.value*100)/100;
  opennew.innerHTML = Math.round(kopen*openslider.value*100)/100;
  closenew.innerHTML = Math.round(kclose*closeslider.value*100)/100;
  escapenew.innerHTML = Math.round(kescape*escapeslider.value*100)/100;
  concnew.innerHTML = Math.round(conc*concslider.value*100)/100;

  document.getElementById("onrate").addEventListener("change", basalFunction);
  document.getElementById("offrate").addEventListener("change", basalFunction);
  document.getElementById("openrate").addEventListener("change", basalFunction);
  document.getElementById("closerate").addEventListener("change", basalFunction);
  document.getElementById("escaperate").addEventListener("change", basalFunction);
  document.getElementById("concentration").addEventListener("change", basalFunction);

  onoutput.innerHTML = Math.round(kon*onslider.value*100)/100; // Display the default slider value
  // Update the current slider value (each time you drag the slider handle)
  onslider.oninput = function() {
      onoutput.innerHTML = Math.round(kon*this.value*100)/100;
      regulatedFunction();
  }

  offoutput.innerHTML = Math.round(koff*offslider.value*100)/100; // Display the default slider value
  // Update the current slider value (each time you drag the slider handle)
  offslider.oninput = function() {
      offoutput.innerHTML = Math.round(koff*this.value*100)/100;
      regulatedFunction();
  }

  openoutput.innerHTML = Math.round(kopen*openslider.value*100)/100; // Display the default slider value
  // Update the current slider value (each time you drag the slider handle)
  openslider.oninput = function() {
    openoutput.innerHTML = Math.round(kopen*this.value*100)/100;
    regulatedFunction();
  }

  closeoutput.innerHTML = Math.round(kclose*closeslider.value*100)/100; // Display the default slider value
  // Update the current slider value (each time you drag the slider handle)
  closeslider.oninput = function() {
    closeoutput.innerHTML = Math.round(kclose*this.value*100)/100;
    regulatedFunction();
  }

  escapeoutput.innerHTML = Math.round(kescape*escapeslider.value*100)/100; // Display the default slider value
  // Update the current slider value (each time you drag the slider handle)
  escapeslider.oninput = function() {
    escapeoutput.innerHTML = Math.round(kescape*this.value*100)/100;
    regulatedFunction();
  }

  concoutput.innerHTML = Math.round(conc*concslider.value*100)/100; // Display the default slider value
  // Update the current slider value (each time you drag the slider handle)
  concslider.oninput = function() {
      concoutput.innerHTML = Math.round(conc*this.value*100)/100;
      regulatedFunction();
  }

  //document.getElementById("basal").innerHTML = "The basal transcript flux at equilibrium is " + bFLUX + " per minute";
  //document.getElementById("regulated").innerHTML = "The regulated transcript flux at equilibrium is " + rFLUX + " per minute";
  //document.getElementById("ratio").innerHTML = "The flux ratio is " + rFLUX/bFLUX;

</script>
